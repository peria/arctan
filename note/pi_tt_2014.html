<!DOCTYPE html>
<title>Pi TechTalk 2014</title>
<meta charset="utf-8">
<script src="http://html5slides.googlecode.com/svn/trunk/slides.js"></script>
<script
   src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
</script>
<script>
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$', '$'], ["\\(", "\\)"]],
      displayMath: [['$$', '$$'], ["\\[", "\\]"]]
    }
  });
</script>
<body style="display: none">
  <section class="slides layout-regular template-default">
    <article>
      <h1>
        Pi Tech Talk 2014<br>
        - arctangent -
      </h1>
      <p>
        <a href="https://twitter.com/peria">peria@</a><br>
        March 14, 2014
      </p>
    </article>

    <article>
      <h3>Table of contents</h3>
      <ul>
        <li>What is arctangent?
        <li>How can we compute &pi; fast?
        <li>How can we find atan formulae?
      </ul>
    </article>

    <article>
      <h3>What is arctangent?</h3>
    </article>

    <article>
      <h2>How can we compute &pi; fast?</h2>
    </article>

    <article>
      <h3>Examples of arctan formulae</h3>
      <ul>
        <li>
          $ \pi = 16 \arctan \frac{1}{5} - 4 \arctan \frac{1}{239} $ (Machin)
        <li>
          $ \pi = 20 \arctan \frac{1}{7} + 8 \arctan \frac{3}{79}$ (Eular)
        <li>
          $ \pi = 48 \arctan \frac{1}{49} + 128 \arctan \frac{1}{57} $ <br>
          $ - 20 \arctan \frac{1}{239} + 48 \arctan \frac{1}{110443} $
          (Takano)
        <li>
          $ \pi = 176 \arctan \frac{1}{57} + 28 \arctan \frac{1}{239} $ <br>
          $ - 48 \arctan \frac{1}{682} + 96 \arctan \frac{1}{12943} $
          (Stormer)
      </ul>
    </article>

    <article>
      <h3>Expansion of an arctan formula</h3>
      $ \arctan \frac{y}{x} $ <br>
      $ = \frac{y}{x} - \frac{y^3}{3x^3}
        + \frac{y^5}{5x^5} - \frac{y^7}{7x^7} + \cdots $<br>
      $ = \frac{y}{x} \left(1 - \frac{y^2}{3x^2} + \frac{y^4}{5x^4}
        - \frac{y^6}{7x^6} + \cdots \right) $<br>
      $ = \frac{y}{x} \left(1 - \frac{y^2}{x^2} \left(\frac{1}{3} -
      \frac{y^2}{5x^2} + \frac{y^4}{7x^4} + \cdots \right)\right) $<br>
      $ = \frac{y}{x} \left(1 - \frac{y^2}{x^2} \left(\frac{1}{3} -
      \frac{y^2}{x^2}\left(\frac{1}{5} - \frac{y^2}{7x^2} +
      \cdots \right)\right)\right) $
      $ = \frac{y}{x} \left(1 - \frac{y^2}{x^2} \left(\frac{1}{3} -
      \frac{y^2}{x^2}\left(\frac{1}{5} - \frac{y^2}{x^2} \left(\frac{1}{7} -
      \cdots \right)\right)\right)\right) $
    </article>

    <article>
      <h3>Computing example of a finite series</h3>
      $ \arctan \frac{1}{5} $ (expand for 4 terms) <br>
      $ = \frac{1}{5} - \frac{1}{3 \cdot 5^3} + \frac{1}{5 \cdot 5^5}
      - \frac{1}{7 \cdot 5^7}$ <br>
      $ = \frac{1}{5} \left(1 - \frac{1}{5^2}\left(\frac{1}{3} -
      \frac{1}{5^2} \left(\frac{1}{5} - \frac{1}{7\cdot5^2} \right)
      \right) \right) $ <br>
      $ = \frac{1}{5} \left(1 - \frac{1}{5^2}\left(\frac{1}{3} -
      \frac{1}{5^2} \left(\frac{1}{5} - 0.005714285714286 \right)
      \right) \right) $ <br>
      $ = \frac{1}{5} \left(1 - \frac{1}{5^2}\left(\frac{1}{3} -
      \frac{0.194285714285714}{5^2} \right) \right) $ <br>
      $ = \frac{1}{5} \left(1 - \frac{1}{5^2}\left(\frac{1}{3} -
      0.007771428571429 \right) \right) $ <br>
      $ = \frac{1}{5} \left(1 - \frac{0.325561904761905}{5^2} \right) $ <br>
      $ = \frac{1}{5} \left(1 - 0.013022476190476 \right) $ <br>
      $ = \frac{0.986977523809524}{5} $ <br>
      $ = 0.197395504761905 $
    </article>

    <article>
      <h3>Pros. &amp; Cons.</h3>

      <h4 class="green">Pros</h4>
      <ul>
        <li>Simple, easy to implement
      </ul>

      <h4 class="red">Cons</h4>
      <ul>
        <li>Each operation costs O(n)
        <li>Whole computing costs O(n<sup>2</sup>)
        <li>Need all computation to get higher precision
      </ul>
    </article>

    <article>
      <h3>Expansion of an arctan formula</h3>
      $ \arctan \frac{y}{x} $ <br>
      $ = \frac{y}{x} \left(1 - \frac{y^2}{x^2} \left(\frac{1}{3} -
      \frac{y^2}{x^2}\left(\frac{1}{5} - \frac{y^2}{x^2} \left(\frac{1}{7} -
      \cdots \right)\right)\right)\right) $ <br>
      $ = \frac{y}{x} \left(1 - \frac{y^2}{x^2} \left(\frac{1}{3} -
      \frac{3y^2}{3x^2}\left(\frac{1}{5} - \frac{5y^2}{5x^2}
      \left(\frac{1}{7} - \cdots \right)\right)\right)\right) $ <br>
      $ = \frac{y}{x} \left(1 - \frac{y^2}{3x^2} \left(1
        - \frac{3y^2}{5x^2} \left(1 - \frac{5y^2}{7x^2} \left(1
        - \cdots \right)\right)\right)\right) $ <br>
      $ = \frac{y}{x} \left(1 + \frac{-y^2}{3x^2} \left(1
        + \frac{-3y^2}{5x^2} \left(1 + \frac{-5y^2}{7x^2} \left(1
        + \cdots \right)\right)\right)\right) $
    </article>

    <article>
      <h3>Reduction of a parenthesis</h3>
      $ \cdots + \frac{a}{b}\left(c + \frac{d}{e}\left(f +
      \frac{g}{h} \left( \cdots \right)\right)\right) \cdots $ <br>
      $ = \cdots + \frac{a}{b}\left(\frac{ec}{e} + \frac{d}{e}\left(f +
      \frac{g}{h} \left( \cdots \right)\right)\right) \cdots $ <br>
      $ = \cdots + \frac{a}{be}\left(ec + d\left(f +
      \frac{g}{h} \left( \cdots \right)\right)\right) \cdots $ <br>
      $ = \cdots + \frac{a}{be}\left(ec + df +
      \frac{dg}{h} \left( \cdots \right)\right) \cdots $ <br>
      $ = \cdots + \frac{a}{A}\left(B + \frac{C}{h} \left(
      \cdots \right)\right) \cdots $

      <div class="build">
        <div>
          <hr>
          $ \cdots + \frac{c_{i-1}}{a_i}\left(b_i + \frac{c_i}{a_{i+1}}
          \left(b_{i+1} + \frac{c_{i+1}}{a_{i+2}} \left( \cdots
          \right)\right)\right) \cdots $
          $ = \cdots + \frac{c_{i-1}}{A_j}\left(B_j + \frac{C_j}{a_{i+2}}
          \left( \cdots \right)\right) \cdots $
          $(A_j,B_j,C_j) = (a_i a_{i+1}, a_{i+1} b_i + b_{i+1}c_i, c_i c_{i+1})$
        </div>
      </div>
    </article>

    <article>
      <h3>Binary splitting method</h3>
      <p>
        Merging $(a_i,b_i,c_i)$ and $(a_{i+1}, b_{i+1}, c_{i+1})$
        to $(A_j, B_j, C_j)$ can be performed on any $i$'s independently.
      </p>
    </article>

    <article>
      <h3>Computing example of a finite series</h3>
      $ \arctan \frac{1}{5} $ (expand for 4 terms) <br>
      $ = \frac{1}{5} - \frac{1}{3 \cdot 5^3} + \frac{1}{5 \cdot 5^5}
      - \frac{1}{7 \cdot 5^7}$ <br>
      $ = \frac{1}{5}\left(1 + \frac{-1}{3\cdot5^2}\left(1 +
      \frac{-3}{5\cdot5^2} \left(1 + \frac{-5}{7\cdot5^2}(1 + 0)
      \right)\right)\right)$ <br>
      $ = \frac{1}{5}\left(1 + \frac{-1}{75}\left(1 + \frac{-3}{125}
      \left(1 + \frac{-5}{175}(1 + 0) \right)\right)\right)$ <br>
      $ = \frac{1}{5\cdot75}\left(1\cdot75-1\cdot1 +
      \frac{(-1)(-3)}{125\cdot175}(1\cdot175-5\cdot1 + 0)\right)$ <br>
      $ = \frac{1}{375}\left(74 + \frac{3}{21875}(170 + 0)\right)$ <br>
      $ = \frac{1}{375\cdot21875}(74\cdot21875 + 3\cdot170 + 0)$ <br>
      $ = \frac{1619260}{8203125} = \frac{323852}{1640625}$ <br>
      $ = 0.197395504761905$
    </article>

    <article>
      <h3>Pros. &amp; Cons.</h3>

      <h4 class="green">Pros</h4>
      <ul>
        <li>Each operation can be done independently.
        <li>Whole computation costs O(n (log(n))<sup>3</sup>).
        <li>Mid-way information is reusable to compute higher precision
      </ul>

      <h4 class="red">Cons</h4>
      <ul>
        <li>Difficult to implement without high precision libraries
          <ul>
            <li>Need FFT-ish multiplications in O(n log(n))
            <li>Need implementation of Newton-Raphson method for division and
              square root operations.
          </ul>
      </ul>
    </article>

    <article>
      <h3>How can compute &pi; fast?</h3>
      <h4>Use binary splitting method (BSM)</h4>
      <ul>
        <li>Can be parallel
        <li>Most computations are done in integers.
        <li>Available with Chudnovsky's formula.
      </ul>
      <h4>Look for effective formulae</h4>
      <p>In computing $\arctan(1/n)$ ...</p>
      <ul>
        <li>The number of terms depends on $n$
        <li>The number of arctans should be small.
        <li>Many $n$'s match in check step.
      </ul>
    </article>

    <article>
      <h3>Examples of arctan formulae</h3>
      <ul>
        <li>
          $ \pi = 16 \arctan \frac{1}{5} - 4 \arctan \frac{1}{239} $ (Machin)
        <li>
          $ \pi = 48 \arctan \frac{1}{49} + 128 \arctan \frac{1}{57} $ <br>
          $ - 20 \arctan \frac{1}{239} + 48 \arctan \frac{1}{110443} $
          (Takano)
        <li>
          $ \pi = 176 \arctan \frac{1}{57} + 28 \arctan \frac{1}{239} $ <br>
          $ - 48 \arctan \frac{1}{682} + 96 \arctan \frac{1}{12943} $
          (Stormer)
      </ul>
      <ul>
        <li>Machin requires 2 BSMs, and Takano requires 4 BSMs.
        <li>arctan(1/5) requires about 3.4 times terms of arctan(1/239)
        <li>Computing arctan(1/57) and arctan(1/239) can be skipped in
          checking of Takano with Stormer.
      </ul>
    </article>

    <article>
      <h2>How can we find atan formulae?</h2>
    </article>

    <article>
      <h3>Known algorithms</h3>
      <ul>
        <li>Chain method
        <li>Search with prime numbers
      </ul>
    </article>

    <article>
      <h3>Chain method</h3>
      <p>A arctan can be splitted into two arctans</p>
      $$\arctan\frac{1}{n} = \arctan\frac{1}{n+a} + \arctan\frac{1}{n+b}$$
      where $ab = n^2 + 1$.
      <section>
        Ex)
        <ul>
          <li>arctan(1/2) = arctan(1/3) + arctan(1/7)
          <li>arctan(1/7) = arctan(1/12) + arctan(1/17)
          <li>arctan(1/73) = arctan(1/47) - arctan(1/132)
      </section>
      <p>
        Ref: <a href="http://www.asahi-net.or.jp/~ag6k-ingc/pi/pi00.htm">
          Designing &pi; formulae</a> (Japanese site)
      </p>
    </article>

    <article>
      <h3>Search with prime numbers</h3>
      <h4>Algorithm</h4>
      <ol>
        <li>Choose $k$ numbers, where all $n^2+1$ are smooth on $k$ primes.
        <li>Compute coefficients of $k$ arctan terms.
        <li>Compute the coefficient of &pi;.
      </ol>
    </article>

    <article>
      <h3>Choose numbers</h3>
      $\{n_i\} = \{49, 57, 239, 110443\}$
      $\{p_i\} = \{2, 5, 13, 1201\}$
      <pre>
$ python -c &quot;for n in [49, 57, 239, 110443]: print n*n+1&quot; | factor
2402: 2 1201
3250: 2 5 5 5 13
57122: 2 13 13 13 13
12197656250: 2 5 5 5 5 5 5 5 5 13 1201
</pre>
      $\{n_i\} = \{57, 239, 682, 12943\}$
      $\{p_i\} = \{2, 5, 13, 61\}$
      <pre>
$ python -c "for n in [57, 239, 682, 12943]: print n*n+1" | factor
3250: 2 5 5 5 13
57122: 2 13 13 13 13
465125: 5 5 5 61 61
167521250: 2 5 5 5 5 13 13 13 61</pre>
    </article>

    <article>
      <h3>Compute coefficients</h3>
      <p>1. Make a $k\times(k-1)$ matrix</p>
      $M_{i,j} = \left\{
      \begin{array}{rl}
       e & (n_i \bmod p_j \leq p_j / 2)\\
      -e & (n_i \bmod p_j > p_j / 2)
      \end{array}
      \right.$
      <p>2. Compute coefficients of arctan's</p>
      $c_i = (-1)^i\det(M_i)$<br>
      $M_i$ is a square matrix, $i$-th row is removed from $M$.
      <p>3. Compute the coefficient of &pi;/4</p>
      $m=\frac{\pi/4}{\sum_i c_i\arctan 1/n_i}$ <br>
      (<code>float64</code> has enough precision to get $m$)
      <p>4. Make a &pi; formula</p>
      $\pi = \frac{4}{m} \sum_i c_i \arctan \frac{1}{n_i}$
    </article>

    <article>
      <h3>Example</h3>
      <section style="font-size:65%">
        $\begin{array}{rcl}
        49^2+1     &=& 2 * 5^0 * 13^0 * 1201^1\\
        57^2+1     &=& 2 * 5^3 * 13^1 * 1201^0\\
        239^2+1    &=& 2 * 5^0 * 13^4 * 1201^0\\
        110443^2+1 &=& 2 * 5^8 * 13^1 * 1201^1
        \end{array}$
        $\therefore M = \left(\begin{array}{ccc}
        0 & 0 & 1\\ 3 & 1 & 0\\ 0 & 4 & 0\\ -8 & -1 & -1
        \end{array}\right)$ <br>
      </section>

      <section style="font-size:65%">
        $\det(M_1) = \left|\begin{array}{ccc}
        3 & 1 & 0\\ 0 & 4 & 0\\ -8 & -1 & -1
        \end{array}\right| = -12$,
        $\det(M_2) = \left|\begin{array}{ccc}
        0 & 0 & 1\\ 0 & 4 & 0\\ -8 & -1 & -1
        \end{array}\right| = 32$<br>
        $\det(M_3) = \left|\begin{array}{ccc}
        0 & 0 & 1\\ 3 & 1 & 0\\ -8 & -1 & -1
        \end{array}\right| = 5$,
        $\det(M_4) = \left|\begin{array}{ccc}
        0 & 0 & 1\\ 3 & 1 & 0\\ 0 & 4 & 0
        \end{array}\right| = 12$
      </section>

      $\begin{array}{rcl}
      \frac{m\pi}{4} &=& 12\arctan\frac{1}{49} + 32\arctan\frac{1}{57}\\
      & &- 5\arctan\frac{1}{239} + 12\arctan\frac{1}{110443}\\
      &=& 0.785398163397448 \sim \frac{\pi}{4}
      \end{array}$
      $\therefore m = 1$
    </article>

    <article>
      <h3>Search with prime numbers</h3>
      <h4>Algorithm</h4>
      <ol>
        <li>Set upper bound of $n$ and $p$.
        <li>Factorize $n^2+1$ for all $n$'s using $p$'s. (Sieving)
        <li>Choose $k$ primes from $p$'s.
        <li>Choose $k$ numbers from $n$, where $n^2+1$ are $p$-smooth
        <li>Compute coefficients.
        <li>Check if the equation is valid.
      </ol>
    </article>

    <article>
      <h2>How can we compute &pi; faster?</h2>
    </article>

    <article>
      <h3>Factorization</h3>
      <h4 class="green">Pros.</h4>
	    <ul>
	      <li>Multiplication of n-digits numbers costs O(n)
        <li>Speeds up reduction of rational numbers.
        <li>Most operations in BSM is multiplications.
	    </ul>
      <h4 class="red">Cons.</h4>
      <ul>
        <li>Slow down additions. (Need to expand exponents)
        <li>Need more implementation. (Human resource)
      </ul>
    </article>
  </section>
</body>
